module.exports=[31112,__turbopack_context__=>__turbopack_context__.a(async(__turbopack_handle_async_dependencies__,__turbopack_async_result__)=>{try{var __TURBOPACK__imported__module__20056__=__turbopack_context__.i(20056),__TURBOPACK__imported__module__39076__=__turbopack_context__.i(39076),__TURBOPACK__imported__module__91274__=__turbopack_context__.i(91274),__turbopack_async_dependencies__=__turbopack_handle_async_dependencies__([__TURBOPACK__imported__module__39076__]);function bufferFromBase64(e){let t=e.indexOf("base64,"),a=t>=0?e.slice(t+7):e;return Buffer.from(a,"base64")}async function generatePdfBuffer(body){return new Promise((resolve,reject)=>{try{let PDFDocument=eval("require")("pdfkit"),doc=new PDFDocument({size:"A4",margin:40,info:{Title:`Application - ${body.firstName} ${body.lastName}`,Author:"Yeti International College"}}),chunks=[];doc.on("data",e=>chunks.push(e)),doc.on("end",()=>resolve(Buffer.concat(chunks)));let colors={primary:"#1e3a8a",secondary:"#64748b",accent:"#f1f5f9",text:"#334155",border:"#e2e8f0"};doc.rect(0,0,595.28,90).fill(colors.primary),doc.fillColor("white").fontSize(20).font("Helvetica-Bold").text("YETI INTERNATIONAL COLLEGE",40,30),doc.fontSize(10).font("Helvetica").text("ADMISSION APPLICATION FORM",40,58);let dateStr=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"});doc.text(`Date: ${dateStr}`,400,30,{align:"right"}),doc.text("Status: Pending",400,45,{align:"right"});let yPos=120,photoWidth=110,photoHeight=130,photoX=445,photoY=110;if(doc.rect(photoX,photoY,photoWidth,photoHeight).strokeColor(colors.secondary).lineWidth(1).stroke(),doc.fillColor(colors.secondary).fontSize(8).text("PHOTO",photoX,photoY+60,{width:photoWidth,align:"center"}),body.photo?.data)try{let photoBuf=bufferFromBase64(body.photo.data);doc.image(photoBuf,photoX,photoY,{fit:[photoWidth,photoHeight],align:"center",valign:"center"})}catch(e){}let textMaxWidth=380;doc.fillColor(colors.primary).fontSize(14).font("Helvetica-Bold").text("PERSONAL DETAILS",40,yPos),doc.rect(40,yPos+18,textMaxWidth,2).fill(colors.accent),yPos+=35;let drawField=(e,t,a,r)=>{doc.fillColor(colors.secondary).fontSize(9).font("Helvetica-Bold").text(e.toUpperCase(),a,r),doc.fillColor(colors.text).fontSize(11).font("Helvetica").text(t||"N/A",a,r+12)};drawField("First Name",body.firstName,40,yPos),drawField("Last Name",body.lastName,220,yPos),yPos+=40,drawField("Email Address",body.email,40,yPos),drawField("Phone Number",body.phone,220,yPos),yPos+=40,drawField("Date of Birth",body.dob,40,yPos),drawField("Address",body.address,220,yPos),yPos=Math.max(yPos+50,260),doc.fillColor(colors.primary).fontSize(14).font("Helvetica-Bold").text("ACADEMIC BACKGROUND",40,yPos),doc.rect(40,yPos+18,515,2).fill(colors.accent),yPos+=35,drawField("Program Applied For",body.courseId,40,yPos),drawField("Previous Institute",body.prevInstitute,300,yPos),yPos+=40,drawField("Board / University",body.board,40,yPos),drawField("GPA / Percentage",body.gpa,300,yPos),yPos+=50,doc.rect(40,yPos,515,80).fill(colors.accent),doc.fillColor(colors.primary).fontSize(10).font("Helvetica-Bold").text("DECLARATION",50,yPos+15),doc.fillColor(colors.text).fontSize(9).font("Helvetica").text("I hereby declare that the information provided above is true and correct to the best of my knowledge. I understand that any incorrect information may lead to the rejection of my application.",50,yPos+35,{width:495}),doc.fontSize(8).fillColor(colors.secondary).text("Generated by Yeti International College Portal",40,780,{align:"center"});let addAttachmentPage=(e,t,a)=>{if(t)try{let r=bufferFromBase64(t);doc.addPage(),doc.rect(0,0,595.28,50).fill(colors.accent),doc.fillColor(colors.primary).fontSize(12).font("Helvetica-Bold").text(`APPENDIX ${a}:  ${e.toUpperCase()}`,0,20,{align:"center"}),doc.rect(40,70,515,700).strokeColor(colors.border).lineWidth(2).stroke(),doc.image(r,42,72,{fit:[511,696],align:"center",valign:"center"}),doc.fontSize(8).fillColor(colors.secondary).text(`Document: ${e} - Applicant: ${body.firstName} ${body.lastName}`,40,780,{align:"center"})}catch(t){console.error(`Error rendering ${e}`,t)}},attachments=[{label:"Marksheet / Transcript",data:body.marksheet?.data},{label:"Character Certificate",data:body.character?.data},{label:"Citizenship / ID",data:body.citizenship?.data}],appendixCount=1;attachments.forEach(e=>{e.data&&(addAttachmentPage(e.label,e.data,appendixCount),appendixCount++)}),doc.end()}catch(err){reject(err)}})}async function POST(e){try{let t=await e.text(),a=null;try{a=t?JSON.parse(t):null}catch(e){return __TURBOPACK__imported__module__20056__.NextResponse.json({error:"Invalid JSON payload",details:e?.message},{status:400})}let r=a;for(let e of["firstName","lastName","email","phone","dob","address","courseId","gpa","prevInstitute","board","marksheet","character","citizenship","photo"])if(!(r[e]||0===r[e]))return __TURBOPACK__imported__module__20056__.NextResponse.json({error:`${e} is required.`},{status:400});let n=await __TURBOPACK__imported__module__39076__.prisma.application.create({data:{firstName:r.firstName,lastName:r.lastName,email:r.email,phone:r.phone,dob:r.dob,address:r.address,courseId:r.courseId,gpa:r.gpa,prevInstitute:r.prevInstitute,board:r.board,marksheet:r.marksheet.name,character:r.character.name,citizenship:r.citizenship.name,photo:r.photo.name}});return(async()=>{try{let e=await generatePdfBuffer(r),t=__TURBOPACK__imported__module__91274__.default.createTransport({host:process.env.SMTP_HOST||"smtp.gmail.com",port:Number(process.env.SMTP_PORT||587),secure:465===Number(process.env.SMTP_PORT||587),auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}}),a="yeticollegenp@gmail.com";await t.sendMail({from:a,to:a,subject:`New Application: ${r.firstName} ${r.lastName}`,text:`Application received for ${r.courseId}. See attached PDF.`,attachments:[{filename:`Application_${r.firstName}.pdf`,content:e}]}),console.log("Email sent for",n.id)}catch(e){console.error("Background error:",e)}})(),__TURBOPACK__imported__module__20056__.NextResponse.json({ok:!0,application:n},{status:201})}catch(e){return console.error("Apply API error:",e),__TURBOPACK__imported__module__20056__.NextResponse.json({error:e?.message||"Server error"},{status:500})}}[__TURBOPACK__imported__module__39076__]=__turbopack_async_dependencies__.then?(await __turbopack_async_dependencies__)():__turbopack_async_dependencies__,__turbopack_context__.s(["POST",()=>POST]),__turbopack_async_result__()}catch(e){__turbopack_async_result__(e)}},!1),86954,e=>e.a(async(t,a)=>{try{var r=e.i(56423),n=e.i(54883),o=e.i(93375),i=e.i(29039),l=e.i(68718),s=e.i(67879),c=e.i(23562),d=e.i(3224),p=e.i(8827),u=e.i(64289),h=e.i(91180),f=e.i(37034),m=e.i(89280),v=e.i(21514),g=e.i(40691),R=e.i(68006),y=e.i(93695);e.i(75506);var C=e.i(29112),N=e.i(31112),A=t([N]);[N]=A.then?(await A)():A;let S="",w=new r.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/apply/route",pathname:"/api/apply",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Yeti-College/app/api/apply/route.ts",nextConfigOutput:S,userland:N}),{workAsyncStorage:P,workUnitAsyncStorage:b,serverHooks:I}=w;function E(){return(0,o.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:b})}async function x(e,t,a){w.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let r="/api/apply/route";r=r.replace(/\/index$/,"")||"/";let o=!1,N=await w.prepare(e,t,{srcPage:r,multiZoneDraftMode:o});if(!N)return t.statusCode=400,t.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:A,params:E,nextConfig:x,parsedUrl:S,isDraftMode:P,prerenderManifest:b,routerServerContext:I,isOnDemandRevalidate:T,revalidateOnlyGenerated:O,resolvedPathname:H,clientReferenceManifest:k,serverActionsManifest:M}=N,_=(0,d.normalizeAppPath)(r),D=!!(b.dynamicRoutes[_]||b.routes[H]),$=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,S,!1):t.end("This page could not be found"),null);if(D&&!P){let e=!!b.routes[H],t=b.dynamicRoutes[_];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await $();throw new y.NoFallbackError}}let U=null;!D||w.isDev||P||(U=H,U="/index"===U?"/":U);let z=!0===w.isDev||!D,B=D&&!z;M&&k&&(0,s.setReferenceManifestsSingleton)({page:r,clientReferenceManifest:k,serverActionsManifest:M,serverModuleMap:(0,c.createServerModuleMap)({serverActionsManifest:M})});let q=e.method||"GET",L=(0,l.getTracer)(),j=L.getActiveScopeSpan(),F={params:E,prerenderManifest:b,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:z,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:a.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r)=>w.onRequestError(e,t,r,I)},sharedContext:{buildId:A}},K=new p.NodeNextRequest(e),G=new p.NodeNextResponse(t),W=u.NextRequestAdapter.fromNodeNextRequest(K,(0,u.signalFromNodeResponse)(t));try{let o=async e=>w.handle(W,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=L.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==h.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=a.get("next.route");if(n){let t=`${q} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${q} ${r}`)}),s=!!(0,i.getRequestMeta)(e,"minimalMode"),c=async i=>{var l,c;let d=async({previousCacheEntry:n})=>{try{if(!s&&T&&O&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await o(i);e.fetchMetrics=F.renderOpts.fetchMetrics;let l=F.renderOpts.pendingWaitUntil;l&&a.waitUntil&&(a.waitUntil(l),l=void 0);let c=F.renderOpts.collectedTags;if(!D)return await (0,m.sendResponse)(K,G,r,F.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,v.toNodeOutgoingHttpHeaders)(r.headers);c&&(t[R.NEXT_CACHE_TAGS_HEADER]=c),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,n=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:C.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await w.onRequestError(e,t,{routerKind:"App Router",routePath:r,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:T})},I),t}},p=await w.handleResponse({req:e,nextConfig:x,cacheKey:U,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:b,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:O,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:s});if(!D)return null;if((null==p||null==(l=p.value)?void 0:l.kind)!==C.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(c=p.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",T?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),P&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,v.fromNodeOutgoingHttpHeaders)(p.value.headers);return s&&D||u.delete(R.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,g.getCacheControlHeader)(p.cacheControl)),await (0,m.sendResponse)(K,G,new Response(p.value.body,{headers:u,status:p.value.status||200})),null};j?await c(j):await L.withPropagatedContext(e.headers,()=>L.trace(h.BaseServerSpan.handleRequest,{spanName:`${q} ${r}`,kind:l.SpanKind.SERVER,attributes:{"http.method":q,"http.target":e.url}},c))}catch(t){if(t instanceof y.NoFallbackError||await w.onRequestError(e,t,{routerKind:"App Router",routePath:_,routeType:"route",revalidateReason:(0,f.getRevalidateReason)({isStaticGeneration:B,isOnDemandRevalidate:T})}),D)throw t;return await (0,m.sendResponse)(K,G,new Response(null,{status:500})),null}}e.s(["handler",()=>x,"patchFetch",()=>E,"routeModule",()=>w,"serverHooks",()=>I,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>b]),a()}catch(e){a(e)}},!1)];

//# sourceMappingURL=Yeti-College_5149cbdd._.js.map